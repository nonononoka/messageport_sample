<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document2</title>
</head>
<body>
<!-- <form onsubmit = "send(event)">
        <p>
            <input type = "text" name = "message" size = "50">
            <input type = "submit" value = "send">
        </p>
</form> -->

<p>
    <input type = "button" value = "create channel and GCed" onclick = "sendportandpostmessage()" > 
</p>

<script>

//まず親ウィンドウへMessagePortを送る
function sendportandpostmessage(){
    let wr1;
    let wr2;
//port1を自分が持って、port2を親に渡す
//実はwindow.openされたとき、親ウィンドウはwindow.openerに入っている
const { port1, port2 } = new MessageChannel();
port1.addEventListener("close",function(e){
		var div=document.createElement("div");
		div.textContent="entangled port is closed";
		document.body.appendChild(div);
});

//port1を利用可能にする
port1.start();

wr1 = new WeakRef(port1);
wr2 = new WeakRef(port2);
window.gc();
}

function postmessage() {
    const { port1, port2 } = new MessageChannel();


}



</script>
</body>
</html>